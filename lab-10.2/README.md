# Lab 10.2: Macros
Grant Butler
Tyler Zars

1. Load the program List.asm coming with this chapter, and generate its listing (note that it is generated by default and the next Tip from Irvine's book actually just disable compilation after listing generation!).

Namely, after loading program List.asm, follow the procedure in the "Tip" at page 73 (Section 3.3.2):

Project->Properties->Configuration_Properties->Microsoft_Macro_Assembler->Listing_File->Generate_Processed_Source_Listing=Yes & List_All_Available_Info=No

Tip: Select Properties from the Project menu. Under Configuration Properties, select Microsoft Macro Assembler. Then select Listing File. In the dialog window, set Generate Preprocessed Source Listing to Yes, and set List All Available Information to No (to avoid excessive data). In Assembled Code Listing File you may change the name of the listing file generated for the project.

Rebuild the code (a link error is generated, and do not attempt to execute, since with listing generation the object file is not created)

Retrieve the listing  "Project.lst" or "List.lst" file (based on the choice in "Assembled Code Listing File") and upload in the submission file the highlighted expansion of the REPEAT (REPT) structure found in this listing (not the whole listing).

2. Reset to default the listing file generation options set at the previous task.  Trace the program and show the snapshot of the started debugging, with the Memory window focused on the data generated by the expansion of the REPEAT structure, in the submission (you can find its address in the register "esi" loaded with the pointer to the linked list after 1 instruction from the start of the main procedure).

Upload the snapshot both separately, and in the docx file

3. Address Problem 10.4.6  8, namely:

Challenge: In the Linked List example program (List.asm) what would be the result if the REPEAT loop were coded as follows?

```as
REPEAT TotalNodeCount
 Counter = Counter + 1
 ListNode <Counter, ($ + SIZEOF ListNode)>
ENDM
```

Trace the program obtained after modification and specify what goes wrong.

Upload the new List.lst file expansion separately and in the .docx file. Also write the requested explanation in the .docx file

4. Look at Section 10.7.2  Problem 16, namely:

Assume the following mLocate macro definition (you need to fix a few lines to get it to compile ;)):

```as
mLocate MACRO xval, yval
  IF xval LT 0
     EXITM
  ENDIF
  ... ; reverse keywords' characters in the next three lines to get it right ;) and comment dots
  FI yval TL 0
     MTIXE
  FIDNE
  .... ; up to here symbols are reversed ;)
  mov bx, 0    ; video page 0
  mov ah, 2    ; locate cursor
  mov dh, yval
  mov dl, xval
  int 10h      ; call BIOS
ENDM
```

Write a complete compilable program using it, and show the source code generated by the preprocessor when the macro is expanded by each of the following statements separately (use disassemble window, or the listing):

```as
.data
row BYTE 15
col BYTE 60
.code
 mLocate -2,20
 mLocate 10,20
 mLocate col,row

main proc
 mov eax, 0
 exit
main endp
end main
```

Write a program that helps you see the requested expansion.

Upload the program and the listing or disassembled window snapshot, both separately and in .docx.

Add in .docx an explanation of what you observed that can go wrong and why? (Hints: Are the macro parameters sufficiently tested? What should be done to enable use of registers or memory for parameters? Is the expansion of the macro executed? If you tried to put it into reachable code parts, what should be done to compile and execute without errors and work when the program is compiled in real mode?)
